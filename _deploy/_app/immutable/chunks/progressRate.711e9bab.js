import{b as l}from"./dbBase.2eec5af3.js";import{D as C,a as w}from"./storeSyncStatus.3b665716.js";import{c as r}from"./logger.cb3e7472.js";import{d as m}from"./CommonItemMember.d32f367b.js";const o=l.EventLog.syncStatus;async function R(t){await u(t,"isSyncTarget",!0,"isSyncing",!0)}async function j(t){const n=`Update syncStaus for aborting. Chain: ${t}`;r.start(n),await u(t,"isSyncing",!0,"isAbort",!0),r.finished(n)}async function x(t){const n=`Update syncStatus for stopping. Chain: ${t}`;r.start(n),await u(t,"isSyncing",!0,"isAbort",!1),await u(t,"isSyncing",!0,"isSyncing",!1),r.finished(n)}async function B(t,n){const a=[],s=`Update syncStatus for stopping. Contract: ${n}`;r.start(s),a.push(e(t,n,"isSyncing",!1)),a.push(e(t,n,"isAbort",!1)),await Promise.all(a),r.finished(s)}async function u(t,n,a,s,c){const i=m({chainName:t}),y=[];for(const S of i.projects)for(const g of S.versions){const p={chainName:t,projectName:S.name,versionName:g.name},f=new C(p);for(const d of await b(f,n,a))y.push(e(f,d.name,s,c))}await Promise.all(y)}async function F(t,n,a){await e(t,n,"isSyncTarget",a),await e(t,n,"numOfSyncTargetContract",a?1:0)}async function h(t,n){return await t.transaction("r",o,async()=>await t.table(o).get(n))}async function b(t,n,a){return await t.transaction("r",o,async()=>(await t.table(o).toArray()).filter(c=>c[n]===a))}async function O(t,n,a){return(await h(t,n))[a]}async function e(t,n,a,s){await I(t,n,{[a]:s})}async function I(t,n,a){const s={...t.versionIdentifier,contractName:n};await t.transaction("rw",t.table(o),async()=>{await t.table(o).update(n,a)}).then(()=>{w.updateState(s,a)})}function D(t,n){const a=10**n;return Math.round(t*a)/a}function $(t,n,a){const s=a-t,c=n-t,i=D(s*100/c,3);return isNaN(i)||i<0?0:i}function M(t){return t>=99.95?t.toFixed(0):t.toFixed(1)}export{$ as a,j as b,R as c,x as d,M as e,O as f,h as g,F as h,B as s,e as u};
